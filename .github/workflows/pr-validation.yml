name: PR Validation ‚Äì SC2 Bot

on:
  pull_request:
    paths:
      - 'game_check/**'
      - 'weapon_check_bot.py'
      - 'build_sc2map.py'
      - '.github/workflows/pr-validation.yml'

jobs:
  build_and_test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        map:
          - PylonAIE_5_0_14
          - MagannathaAIE_5_0_14
          - UltraloveAIE_5_0_14
          - LeyLinesAIE_5_0_14
          - TorchesAIE_5_0_14
          - PersephoneAIE_5_0_14
    name: Build & Test ${{ matrix.map }}
    uses: ./.github/workflows/shared-build-map.yaml
    with:
      map: ${{ matrix.map }}

    steps:
      - uses: actions/checkout@v4

      - name: üîÑ Build SC2 Map (Reusable Workflow)
        uses: ./.github/workflows/shared-build-map.yaml
        with:
          map: ${{ matrix.map }}

      - name: üê≥ Pull SC2 Docker image
        run: docker pull aiarena/arenaclient:latest

      - name: üß™ Run weapon check bot
        run: |
          MAP="${{ matrix.map }}"
          docker run --rm \
            -v "${{ github.workspace }}:/workspace" \
            -v "${{ github.workspace }}/Output:/root/StarCraftII/Maps" \
            --entrypoint python \
            aiarena/arenaclient:latest \
            /workspace/game_check/weapon_check_bot.py --map "$MAP"
          RET=$?
          if [ $RET -ne 0 ]; then
            echo "‚ùå Validation failed for $MAP"
            exit 1
          fi
